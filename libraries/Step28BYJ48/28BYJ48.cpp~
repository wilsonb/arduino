/*
  28BYJ48.cpp - Library for Controlling Stepper Motor 28BYJ-48 with
  a ULN2003A driver chip.

  Code based on example provided by 4tronix
  http://www.4tronix.co.uk/arduino/Stepper-Motors.php

  Created by Brian Wilson, May 16, 2013.
*/

#include "Arduino.h"
#include "28BYH48.h"


//Define Arduino Pins
const int bluePin = 8;
const int pinkPin = 9;
const int yellowPin = 10;
const int orangePin = 11;

//Define Stepper Motor Constants
const int revs = 512; //Number of steps per full revolution
int motorSpeed = 1200; //stepper motor speed


/*
  8 phase output order is in the following sequence:

  1. Drive IN4 only		5. Drive IN2 only
  2. Drive IN4 and IN3		6. Drive IN2 and IN1
  3. Drive IN3 only		7. Drive IN1 only
  4. Drive IN3 and IN2		8. Drive IN4 and IN1

*/

//The following bits perform the 8-phase output as shown:
//               1       2       3       4       5       6       7       8 
int lookup[8] = {B01000, B01100, B00100, B00110, B00010, B00011, B00001, B01001};


28BYStep::28BYStep()
{
	
	pinMode(bluePin, OUTPUT);
	pinMode(pinkPin, OUTPUT);
	pinMode(yellowPin, OUTPUT);
	pinMode(OrangePin, OUTPUT);

}

void 28BYStep::clockwise(float steps)
{

	for (int i = 0; i < numdisplays; i++) {
		val[i] = digits[display[i]];
		}
//Output val array to shift register(s)
	for (int j = numdisplays-1; j > -1; j--){
		shiftOut(dataPin,clockPin,MSBFIRST, val[j]);
		}		
//Turn latch pin to high to signal end of data stream
	digitalWrite(latchPin, HIGH);


}

void SevenSeg::loading(int display[])
{
//Turn latch pin low to allow shift register to read data	
	digitalWrite(latchPin, LOW);
	
//Fill val[] array from input array display[]
	for (int i = 0; i < numdisplays; i++) {
		val[i] = loader[display[i]];
		}
//Output val array to shift register(s)
	for (int j = numdisplays-1; j > -1; j--){
		shiftOut(dataPin,clockPin,MSBFIRST, val[j]);
		}		
//Turn latch pin to high to signal end of data stream
	digitalWrite(latchPin, HIGH);


}

void setOutput(int out)
{
  digitalWrite(bluePin, bitRead(lookup[out], 0));
  digitalWrite(pinkPin, bitRead(lookup[out], 1));
  digitalWrite(yellowPin, bitRead(lookup[out], 2));
  digitalWrite(orangePin, bitRead(lookup[out], 3));
}

